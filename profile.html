<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile - BrandBuzz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>
<body class="bg-gradient-to-br from-cyan-50 to-white min-h-screen">

  <!-- Navbar (same as dashboard) -->
  <nav class="bg-white shadow-lg sticky top-0 z-50">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <span class="text-3xl">❤️</span>
        <span class="text-2xl font-bold text-orange-500">BrandBuzz</span>
      </div>
      <div class="flex items-center gap-4">
        <span>Welcome, <strong id="userName">User</strong></span>
        <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Logout</button>
      </div>
    </div>
  </nav>

  <div class="container mx-auto px-6 py-10">
    <h1 class="text-4xl font-bold text-center mb-10 text-gray-800">My Profile</h1>

    <!-- Profile Card -->
    <div class="bg-white rounded-2xl shadow-xl p-8 mb-10 max-w-3xl mx-auto text-center">
      <img id="profilePic" src="" alt="Profile" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-orange-500 object-cover">
      <h2 id="displayName" class="text-3xl font-bold mb-2"></h2>
      <p id="userEmail" class="text-gray-600 mb-6"></p>
      <p class="text-lg">Member since: <span id="joinedDate">Loading...</span></p>
    </div>

    <!-- Enrolled Courses -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold text-gray-800 mb-6">Enrolled Courses</h2>
      <div id="enrolledList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
    </section>

    <!-- Completed Courses + Certificates -->
    <section>
      <h2 class="text-3xl font-bold text-gray-800 mb-6">Completed Courses & Certificates</h2>
      <div id="completedList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const firebaseConfig = {
      // Apna config paste kar
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      projectId: "your-project",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      // Profile info
      document.getElementById('userName').textContent = user.displayName || user.email.split('@')[0];
      document.getElementById('displayName').textContent = user.displayName || 'User';
      document.getElementById('userEmail').textContent = user.email;
      document.getElementById('profilePic').src = user.photoURL || 'https://via.placeholder.com/128?text=User';
      document.getElementById('joinedDate').textContent = user.metadata.creationTime ? new Date(user.metadata.creationTime).toLocaleDateString() : 'N/A';

      // Fetch user profile from Firestore
      const userDocRef = doc(db, 'users', user.uid);
      const userSnap = await getDoc(userDocRef);

      if (userSnap.exists()) {
        const data = userSnap.data();

        // Enrolled Courses
        const enrolledDiv = document.getElementById('enrolledList');
        enrolledDiv.innerHTML = '';
        if (data.enrolledCourses?.length > 0) {
          data.enrolledCourses.forEach(async (courseId) => {
            const courseSnap = await getDoc(doc(db, 'courses', courseId));
            if (courseSnap.exists()) {
              const c = courseSnap.data();
              enrolledDiv.innerHTML += `
                <div class="bg-white p-6 rounded-xl shadow-lg">
                  <img src="\( {c.thumbnailUrl || 'https://via.placeholder.com/300x180'}" alt=" \){c.title}" class="w-full h-40 object-cover rounded-lg mb-4">
                  <h3 class="text-xl font-bold">${c.title}</h3>
                  <p class="text-gray-600">${c.description.substring(0, 100)}...</p>
                  <p class="text-orange-600 font-semibold mt-2">Price: ₹${c.price}</p>
                </div>
              `;
            }
          });
        } else {
          enrolledDiv.innerHTML = '<p class="text-gray-600 text-center">No enrolled courses yet.</p>';
        }

        // Completed Courses + Certificates
        const completedDiv = document.getElementById('completedList');
        completedDiv.innerHTML = '';
        if (data.completedCourses?.length > 0) {
          data.completedCourses.forEach(item => {
            completedDiv.innerHTML += `
              <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold">${item.courseTitle || 'Course'}</h3>
                <p class="text-gray-600">Completed on: ${item.completionDate ? new Date(item.completionDate.toDate()).toLocaleDateString() : 'N/A'}</p>
                <p class="text-green-600 font-semibold">Level: ${item.level || 'N/A'}</p>
                ${item.certificateUrl ? `
                  <a href="${item.certificateUrl}" target="_blank" class="block mt-4 bg-green-600 text-white py-3 rounded-xl text-center hover:bg-green-700">
                    Download Certificate
                  </a>
                ` : '<p class="text-gray-500 mt-4">Certificate generating soon...</p>'}
              </div>
            `;
          });
        } else {
          completedDiv.innerHTML = '<p class="text-gray-600 text-center">No completed courses yet.</p>';
        }
      } else {
        // First time – create basic profile doc
        // You can add this logic if needed
      }
    });

    window.logout = () => signOut(auth).then(() => location.href = 'login.html');
  </script>
</body>
</html>
